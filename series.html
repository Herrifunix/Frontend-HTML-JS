<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Netflix - S√©ries</title>
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/dashboard.css">
    <link rel="stylesheet" href="css/responsive.css">
    <link href="https://fonts.googleapis.com/css2?family=Helvetica+Neue:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body class="dashboard-page">
    <!-- Header -->
    <header class="dashboard-header">
        <div class="container">
            <div class="header-left">
                <img src="https://logos-world.net/wp-content/uploads/2020/04/Netflix-Logo.png" alt="Netflix" class="logo">
                <button class="mobile-menu-toggle" onclick="toggleMobileMenu()" style="display: none;">‚ò∞</button>
                <nav class="main-nav" id="mainNav">
                    <a href="dashboard.html" class="nav-link">Accueil</a>
                    <a href="series.html" class="nav-link active">S√©ries</a>
                    <a href="films.html" class="nav-link">Films</a>
                    <a href="nouveautes.html" class="nav-link">Nouveaut√©s</a>
                    
                </nav>
            </div>
            
            <div class="header-right">
                <div class="search-container">
                    <input type="text" class="search-input" placeholder="Rechercher des s√©ries..." id="searchInput">
                    <button class="search-btn" id="searchBtn">
                        <svg viewBox="0 0 24 24" width="20" height="20">
                            <path fill="currentColor" d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
                        </svg>
                    </button>
                    <div class="search-dropdown" id="searchDropdown">
                        <!-- Les r√©sultats de recherche appara√Ætront ici -->
                    </div>
                </div>
                
                <div class="profile-menu">
                    <img src="https://i.pinimg.com/564x/5b/50/e7/5b50e75d07c726d36f397f6359098f58.jpg" alt="Profil" class="profile-avatar">
                    <div class="dropdown-menu">
                        <a href="profile.html" class="dropdown-item">G√©rer les profils</a>
                        <a href="account.html" class="dropdown-item">Compte</a>
                        <a href="#" class="dropdown-item">Centre d'aide</a>
                        <hr>
                        <a href="index.html" class="dropdown-item">Se d√©connecter</a>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Hero Section for TV Shows -->
    <section class="hero-section">
        <div class="hero-background">
            <img src="https://images8.alphacoders.com/127/1271806.jpg" alt="S√©ries TV">
        </div>
        <div class="hero-content">
            <div class="hero-info">
                <h1 class="hero-title">D√©couvrez les meilleures s√©ries</h1>
                <p class="hero-description">
                    Plongez dans l'univers captivant des s√©ries les plus populaires, des drames aux com√©dies, en passant par les thrillers et la science-fiction.
                </p>
                <div class="hero-buttons">
                    <button class="btn-play" onclick="window.location.href='player.html'">
                        ‚ñ∂ Lecture
                    </button>
                    <button class="btn-info">
                        ‚Ñπ Plus d'infos
                    </button>
                </div>
            </div>
        </div>
    </section>

    <!-- Content Sections -->
    <main class="main-content">
        <div class="container">
            <!-- Search Results (Hidden by default) -->
            <div class="search-results" id="searchResults" style="display: none;">
                <h2>R√©sultats de recherche</h2>
                <div class="content-row" id="searchResultsContainer">
                    <!-- Search results will be populated here -->
                </div>
            </div>
            
            <!-- Popular TV Shows -->
            <section class="content-section">
                <h2 class="section-title">S√©ries populaires</h2>
                <div class="content-row" id="popularTVContent">
                    <!-- Content will be populated by JavaScript -->
                </div>
            </section>
            
            <!-- Netflix Originals -->
            <section class="content-section">
                <h2 class="section-title">S√©ries originales Netflix</h2>
                <div class="content-row" id="originalsTVContent">
                    <!-- Content will be populated by JavaScript -->
                </div>
            </section>
            
            <!-- Top Rated TV Shows -->
            <section class="content-section">
                <h2 class="section-title">S√©ries les mieux not√©es</h2>
                <div class="content-row" id="topRatedTVContent">
                    <!-- Content will be populated by JavaScript -->
                </div>
            </section>
            
            <!-- Drama TV Shows -->
            <section class="content-section">
                <h2 class="section-title">S√©ries dramatiques</h2>
                <div class="content-row" id="dramaTVContent">
                    <!-- Content will be populated by JavaScript -->
                </div>
            </section>
            
            <!-- Comedy TV Shows -->
            <section class="content-section">
                <h2 class="section-title">S√©ries comiques</h2>
                <div class="content-row" id="comedyTVContent">
                    <!-- Content will be populated by JavaScript -->
                </div>
            </section>
        </div>
    </main>

    <!-- Modal for series details -->
    <div class="modal-overlay" id="modalOverlay">
        <div class="modal-content">
            <button class="modal-close" id="modalClose">&times;</button>
            <div class="modal-body" id="modalBody">
                <!-- Modal content will be populated by JavaScript -->
            </div>
        </div>
    </div>
    
    <!-- Scripts -->
    <script src="api.js"></script>
    <script src="script.js"></script>
    <script src="pages-script.js"></script>
    <script src="search.js"></script>
    <script>
        // Initialiser sp√©cifiquement pour les s√©ries
        document.addEventListener('DOMContentLoaded', function() {
            initializeSeriesPage();
        });
        
        async function initializeSeriesPage() {
            console.log('üì∫ Initialisation page S√©ries');
            
            try {
                // Afficher un indicateur de chargement
                showSeriesLoadingIndicator();
                
                // Charger le h√©ro avec trailer pour les s√©ries
                await loadSeriesHero();
                
                // Charger le contenu des s√©ries
                await loadSeriesContent();
                
                // Initialiser les fonctionnalit√©s interactives
                initializeDashboardFeatures();
                
                console.log('‚úÖ Page S√©ries initialis√©e avec succ√®s');
                
            } catch (error) {
                console.error('‚ùå Erreur lors de l\'initialisation des s√©ries:', error);
                showErrorMessage('Erreur de chargement. Veuillez rafra√Æchir la page.');
            }
        }
        
        async function loadSeriesHero() {
            console.log('üì∫ Chargement du h√©ro des s√©ries...');
            
            try {
                // R√©cup√©rer les s√©ries populaires pour le h√©ro
                const popularShows = await contentManager.loadPopularTVShows();
                
                if (popularShows && popularShows.length > 0) {
                    // Prendre le premier √©l√©ment et r√©cup√©rer ses d√©tails avec trailer
                    const heroShow = popularShows[0];
                    const detailedHero = await contentManager.getContentDetails(heroShow.id, 'tv');
                    updateSeriesHeroSection(detailedHero);
                    console.log(`‚úÖ H√©ro s√©ries mis √† jour: ${detailedHero.title}`);
                }
                
            } catch (error) {
                console.error('‚ùå Erreur lors du chargement du h√©ro des s√©ries:', error);
                // Garder le h√©ro par d√©faut en cas d'erreur
            }
        }
        
        function updateSeriesHeroSection(item) {
            const heroTitle = document.querySelector('.hero-title');
            const heroDescription = document.querySelector('.hero-description');
            const heroBackground = document.querySelector('.hero-background');
            
            if (heroTitle) {
                heroTitle.textContent = `üì∫ ${item.title || 'S√©rie non disponible'}`;
            }
            
            if (heroDescription) {
                heroDescription.textContent = item.description || 'Description non disponible.';
            }
            
            if (heroBackground) {
                // Si on a un trailer, on remplace l'image par une iframe YouTube
                if (item.trailer) {
                    heroBackground.innerHTML = `
                        <iframe 
                            src="${item.trailer}&controls=0&showinfo=0&rel=0&modestbranding=1&fs=0&disablekb=1" 
                            frameborder="0" 
                            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                            allowfullscreen
                            style="width: 100%; height: 100%; object-fit: cover; pointer-events: none;"
                        ></iframe>
                    `;
                } else {
                    // Sinon, on garde l'image ou une image par d√©faut
                    const backdropUrl = item.backdrop || item.image || 'https://images8.alphacoders.com/127/1271806.jpg';
                    heroBackground.innerHTML = `<img src="${backdropUrl}" alt="${item.title || 'S√©ries'}">`;
                }
            }
            
            // Mettre √† jour le bouton "Plus d'infos" pour la modal
            const heroInfoBtn = document.querySelector('.btn-info');
            if (heroInfoBtn) {
                console.log(`üîß [S√âRIES] Mise √† jour du bouton hero pour: ${item.title} (ID: ${item.id})`);
                
                // Supprimer tous les anciens event listeners
                const newInfoBtn = heroInfoBtn.cloneNode(true);
                heroInfoBtn.parentNode.replaceChild(newInfoBtn, heroInfoBtn);

                // Ajouter le nouveau event listener pour la modal
                newInfoBtn.addEventListener('click', function() {
                    console.log(`üéØ [S√âRIES] Ouverture modal pour: ${item.title} (ID: ${item.id})`);
                    showContentModal(item.id, 'tv');
                });
                
                console.log(`‚úÖ [S√âRIES] Bouton hero connect√© √† ${item.title}`);
            } else {
                console.warn('‚ö†Ô∏è [S√âRIES] Bouton .btn-info non trouv√©');
            }
        }
        
        async function loadSeriesContent() {
            console.log('üì° Chargement du contenu des s√©ries...');
            
            try {
                const [popularTV, originalsTV, topRatedTV, dramaTV, comedyTV] = await Promise.allSettled([
                    contentManager.loadPopularTVShows(),
                    contentManager.loadNetflixOriginalsTV(),
                    contentManager.loadTopRatedTVShows(),
                    contentManager.loadDramaTVShows(),
                    contentManager.loadComedyTVShows()
                ]);
                
                if (popularTV.status === 'fulfilled') {
                    populateContentSection('popularTVContent', popularTV.value);
                }
                
                if (originalsTV.status === 'fulfilled') {
                    populateContentSection('originalsTVContent', originalsTV.value);
                }
                
                if (topRatedTV.status === 'fulfilled') {
                    populateContentSection('topRatedTVContent', topRatedTV.value);
                }
                
                if (dramaTV.status === 'fulfilled') {
                    populateContentSection('dramaTVContent', dramaTV.value);
                }
                
                if (comedyTV.status === 'fulfilled') {
                    populateContentSection('comedyTVContent', comedyTV.value);
                }
                
            } catch (error) {
                console.error('‚ùå Erreur lors du chargement des s√©ries:', error);
                throw error;
            }
        }
        
        function showSeriesLoadingIndicator() {
            const indicators = ['popularTVContent', 'originalsTVContent', 'topRatedTVContent', 'dramaTVContent', 'comedyTVContent'];
            indicators.forEach(id => {
                const container = document.getElementById(id);
                if (container) {
                    container.innerHTML = '<div class="loading-placeholder">üì∫ Chargement des s√©ries...</div>';
                }
            });
        }
    </script>
    
    <!-- Scripts -->
    <script src="api.js"></script>
    <script src="script.js"></script>
    <script src="pages-script.js"></script>
    <script src="search.js"></script>
    
    <script>
        // Test pour diagnostiquer le probl√®me s√©ries
        console.log('üì∫ TEST S√âRIES - Page s√©ries charg√©e');
        console.log('API_KEY disponible?', typeof API_KEY !== 'undefined' ? 'OUI' : 'NON');
        console.log('TMDB_CONFIG disponible?', typeof TMDB_CONFIG !== 'undefined' ? 'OUI' : 'NON');
        console.log('contentManager disponible?', typeof contentManager !== 'undefined' ? 'OUI' : 'NON');
        
        setTimeout(() => {
            console.log('üì∫ TEST - V√©rification initializeSeriesPage...');
            if (typeof initializeSeriesPage === 'function') {
                console.log('‚úÖ Fonction trouv√©e, for√ßage appel...');
                initializeSeriesPage().catch(error => {
                    console.error('‚ùå Erreur lors du for√ßage:', error);
                });
            } else {
                console.error('‚ùå Fonction initializeSeriesPage non trouv√©e');
            }
            
            // Test direct du bouton apr√®s 3 secondes
            setTimeout(() => {
                console.log('üîç TEST BOUTON - Recherche du bouton Plus d\'infos...');
                const heroButton = document.querySelector('.btn-info');
                console.log('Bouton trouv√©?', heroButton ? 'OUI' : 'NON');
                
                if (heroButton) {
                    console.log('Bouton HTML:', heroButton.outerHTML);
                    console.log('Bouton listeners existants?', heroButton._listeners ? 'OUI' : 'NON');
                    
                    // Ajouter un listener de test direct
                    heroButton.addEventListener('click', function() {
                        console.log('üéØ TEST - Bouton cliqu√© directement !');
                        alert('Test - Bouton Plus d\'infos cliqu√©!');
                    });
                    
                    console.log('‚úÖ Listener de test ajout√© au bouton');
                } else {
                    console.error('‚ùå Aucun bouton .btn-info trouv√©');
                }
            }, 3000);
            
        }, 1000);
    </script>
</body>
</html>