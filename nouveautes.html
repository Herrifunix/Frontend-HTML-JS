<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Netflix - Nouveautés</title>
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/dashboard.css">
    <link rel="stylesheet" href="css/responsive.css">
    <link href="https://fonts.googleapis.com/css2?family=Helvetica+Neue:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body class="dashboard-page">
    <!-- Header -->
    <header class="dashboard-header">
        <div class="container">
            <div class="header-left">
                <img src="https://logos-world.net/wp-content/uploads/2020/04/Netflix-Logo.png" alt="Netflix" class="logo">
                <nav class="main-nav">
                    <a href="dashboard.html" class="nav-link">Accueil</a>
                    <a href="series.html" class="nav-link">Séries</a>
                    <a href="films.html" class="nav-link">Films</a>
                    <a href="nouveautes.html" class="nav-link active">Nouveautés</a>
                    
                </nav>
            </div>
            
            <div class="header-right">
                <div class="search-container">
                    <input type="text" class="search-input" placeholder="Rechercher des nouveautés..." id="searchInput">
                    <button class="search-btn" id="searchBtn">
                        <svg viewBox="0 0 24 24" width="20" height="20">
                            <path fill="currentColor" d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
                        </svg>
                    </button>
                    <div class="search-dropdown" id="searchDropdown">
                        <!-- Les résultats de recherche apparaîtront ici -->
                    </div>
                </div>
                
                <div class="profile-menu">
                    <img src="https://i.pinimg.com/564x/5b/50/e7/5b50e75d07c726d36f397f6359098f58.jpg" alt="Profil" class="profile-avatar">
                    <div class="dropdown-menu">
                        <a href="profile.html" class="dropdown-item">Gérer les profils</a>
                        <a href="account.html" class="dropdown-item">Compte</a>
                        <a href="#" class="dropdown-item">Centre d'aide</a>
                        <hr>
                        <a href="index.html" class="dropdown-item">Se déconnecter</a>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Hero Section for New Releases -->
    <section class="hero-section">
        <div class="hero-background">
            <img src="https://images5.alphacoders.com/133/1330863.jpg" alt="Nouveautés">
        </div>
        <div class="hero-content">
            <div class="hero-info">
                <h1 class="hero-title">🆕 Nouveautés de la semaine</h1>
                <p class="hero-description">
                    Découvrez les dernières sorties et les nouveaux ajouts à notre catalogue. Ne manquez aucune nouveauté avec les derniers films et séries ajoutés cette semaine.
                </p>
                <div class="hero-buttons">
                    <button class="btn-play" onclick="window.location.href='dashboard.html'">
                        🎬 Explorer
                    </button>
                </div>
            </div>
        </div>
    </section>

    <!-- Content Sections -->
    <main class="main-content">
        <div class="container">
            <!-- Search Results (Hidden by default) -->
            <div class="search-results" id="searchResults" style="display: none;">
                <h2>Résultats de recherche</h2>
                <div class="content-row" id="searchResultsContainer">
                    <!-- Search results will be populated here -->
                </div>
            </div>
            
            <!-- New This Week -->
            <section class="content-section">
                <h2 class="section-title">🔥 Nouveautés de cette semaine</h2>
                <div class="content-row" id="newThisWeekContent">
                    <!-- Content will be populated by JavaScript -->
                </div>
            </section>
            
            <!-- Upcoming Movies -->
            <section class="content-section">
                <h2 class="section-title">🎬 Films à venir</h2>
                <div class="content-row" id="upcomingMoviesContent">
                    <!-- Content will be populated by JavaScript -->
                </div>
            </section>
            
            <!-- New TV Shows -->
            <section class="content-section">
                <h2 class="section-title">📺 Nouvelles séries</h2>
                <div class="content-row" id="newTVShowsContent">
                    <!-- Content will be populated by JavaScript -->
                </div>
            </section>
            
            <!-- Recently Added -->
            <section class="content-section">
                <h2 class="section-title">➕ Récemment ajoutés</h2>
                <div class="content-row" id="recentlyAddedContent">
                    <!-- Content will be populated by JavaScript -->
                </div>
            </section>
            
            <!-- Trending Today -->
            <section class="content-section">
                <h2 class="section-title">📈 Tendances du jour</h2>
                <div class="content-row" id="trendingTodayContent">
                    <!-- Content will be populated by JavaScript -->
                </div>
            </section>
            
            <!-- New Netflix Originals -->
            <section class="content-section">
                <h2 class="section-title">🌟 Nouveaux Netflix Originals</h2>
                <div class="content-row" id="newNetflixOriginalsContent">
                    <!-- Content will be populated by JavaScript -->
                </div>
            </section>
        </div>
    </main>

    <!-- Modal for content details -->
    <div class="modal-overlay" id="modalOverlay">
        <div class="modal-content">
            <button class="modal-close" id="modalClose">&times;</button>
            <div class="modal-body" id="modalBody">
                <!-- Modal content will be populated by JavaScript -->
            </div>
        </div>
    </div>
    
    <!-- Scripts -->
    <script src="api.js"></script>
    <script src="script.js"></script>
    <script src="pages-script.js"></script>
    <script src="search.js"></script>
    <script>
        // Initialiser spécifiquement pour les nouveautés
        document.addEventListener('DOMContentLoaded', function() {
            initializeNewReleasesPage();
        });
        
        async function initializeNewReleasesPage() {
            console.log('🆕 Initialisation page Nouveautés');
            
            try {
                // Afficher un indicateur de chargement
                showNewReleasesLoadingIndicator();
                
                // Charger le héro avec trailer pour les nouveautés
                await loadNewReleasesHero();
                
                // Charger le contenu des nouveautés
                await loadNewReleasesContent();
                
                // Initialiser les fonctionnalités interactives
                initializeDashboardFeatures();
                
                console.log('✅ Page Nouveautés initialisée avec succès');
                
            } catch (error) {
                console.error('❌ Erreur lors de l\'initialisation des nouveautés:', error);
                showErrorMessage('Erreur de chargement. Veuillez rafraîchir la page.');
            }
        }
        
        async function loadNewReleasesHero() {
            console.log('🆕 Chargement du héro des nouveautés...');
            
            try {
                // Récupérer les tendances de la semaine pour le héro
                const newThisWeek = await contentManager.loadNewThisWeek();
                
                if (newThisWeek && newThisWeek.length > 0) {
                    // Prendre le premier élément et récupérer ses détails avec trailer
                    const heroItem = newThisWeek[0];
                    const detailedHero = await contentManager.getContentDetails(heroItem.id, heroItem.type);
                    updateNewReleasesHeroSection(detailedHero);
                    console.log(`✅ Héro nouveautés mis à jour: ${detailedHero.title}`);
                }
                
            } catch (error) {
                console.error('❌ Erreur lors du chargement du héro des nouveautés:', error);
                // Garder le héro par défaut en cas d'erreur
            }
        }
        
        function updateNewReleasesHeroSection(item) {
            const heroTitle = document.querySelector('.hero-title');
            const heroDescription = document.querySelector('.hero-description');
            const heroBackground = document.querySelector('.hero-background');
            
            if (heroTitle) {
                heroTitle.textContent = `🆕 ${item.title || 'Nouveauté non disponible'}`;
            }
            
            if (heroDescription) {
                heroDescription.textContent = item.description || 'Description non disponible.';
            }
            
            if (heroBackground) {
                // Si on a un trailer, on remplace l'image par une iframe YouTube
                if (item.trailer) {
                    heroBackground.innerHTML = `
                        <iframe 
                            src="${item.trailer}&controls=0&showinfo=0&rel=0&modestbranding=1&fs=0&disablekb=1" 
                            frameborder="0" 
                            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                            allowfullscreen
                            style="width: 100%; height: 100%; object-fit: cover; pointer-events: none;"
                        ></iframe>
                    `;
                } else {
                    // Sinon, on garde l'image ou une image par défaut
                    const backdropUrl = item.backdrop || item.image || 'https://images5.alphacoders.com/133/1330863.jpg';
                    heroBackground.innerHTML = `<img src="${backdropUrl}" alt="${item.title || 'Nouveautés'}">`;
                }
            }
        }
        
        async function loadNewReleasesContent() {
            console.log('📡 Chargement du contenu des nouveautés...');
            
            try {
                const [newThisWeek, upcomingMovies, newTVShows, recentlyAdded, trendingToday, newNetflixOriginals] = await Promise.allSettled([
                    contentManager.loadNewThisWeek(),
                    contentManager.loadUpcomingMovies(),
                    contentManager.loadNewTVShows(),
                    contentManager.loadRecentlyAdded(),
                    contentManager.loadTrendingToday(),
                    contentManager.loadNewNetflixOriginals()
                ]);
                
                if (newThisWeek.status === 'fulfilled') {
                    populateContentSection('newThisWeekContent', newThisWeek.value);
                }
                
                if (upcomingMovies.status === 'fulfilled') {
                    populateContentSection('upcomingMoviesContent', upcomingMovies.value);
                }
                
                if (newTVShows.status === 'fulfilled') {
                    populateContentSection('newTVShowsContent', newTVShows.value);
                }
                
                if (recentlyAdded.status === 'fulfilled') {
                    populateContentSection('recentlyAddedContent', recentlyAdded.value);
                }
                
                if (trendingToday.status === 'fulfilled') {
                    populateContentSection('trendingTodayContent', trendingToday.value);
                }
                
                if (newNetflixOriginals.status === 'fulfilled') {
                    populateContentSection('newNetflixOriginalsContent', newNetflixOriginals.value);
                }
                
            } catch (error) {
                console.error('❌ Erreur lors du chargement des nouveautés:', error);
                throw error;
            }
        }
        
        function showNewReleasesLoadingIndicator() {
            const indicators = ['newThisWeekContent', 'upcomingMoviesContent', 'newTVShowsContent', 'recentlyAddedContent', 'trendingTodayContent', 'newNetflixOriginalsContent'];
            indicators.forEach(id => {
                const container = document.getElementById(id);
                if (container) {
                    container.innerHTML = '<div class="loading-placeholder">🆕 Chargement des nouveautés...</div>';
                }
            });
        }
    </script>
</body>
</html>